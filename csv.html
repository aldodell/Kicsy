<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Grupo Selva</title>
    <link rel="shortcut icon" href="#">

</head>

<document>
    <script src="kicsy.js"></script>
    <script>

        // KMessage("system", "desktop", "Kicsy", "system", "update").send();



        let ventana = KWindow().setSize(1200, 800).publish();
        let entrada, salida, mascara;





        function convertir() {
            let csv = entrada.getValue();
            let lines = csv.split("\n");
            let headers = lines[0].split(";");
            let result = [];
            for (let i = 1; i < lines.length; i++) {
                let obj = {};
                let currentline = lines[i].split(";");
                for (let j = 0; j < headers.length; j++) {
                    obj[headers[j]] = currentline[j];
                }
                result.push(obj);
            }

            let mask = mascara.getValue();
            let line = "";
            for (let row of result) {
                //line += eval("`" + mask + "`") //`insert asignaciones (cedulaEvaluador, cedulaEvaluado) values (${row.cedulaEvaluador}, ${row.cedulaEvaluado});\r\n`;
                line += eval(`\` ${mask} \``) //`insert asignaciones (cedulaEvaluador, cedulaEvaluado) values (${row.cedulaEvaluador}, ${row.cedulaEvaluado});\r\n`; //eval(`\` ${mask`) //`insert asignaciones (cedulaEvaluador, cedulaEvaluado) values (${row.cedulaEvaluador}, ${row.cedulaEvaluado});\r\n`;
            }

            salida.setValue(line);



        }

        ventana.add(

            KColumn(

                KTextArea()
                    .addCssText(" width: 100%; height: 30%;")

                    .getMe(function (me) { entrada = me; })
                ,

                KText()
                    .addCssText("width: 100%; height: 30px;")

                    .getMe(function (me) { mascara = me; })
                ,


                KTextArea()
                    .addCssText(" width: 100%; height: 30%;")
                    .getMe(function (me) { salida = me; })
                    .setValue("hola"),
                KButton()
                    .setValue("Convertir")
                    .addEvent("click", () => {
                        convertir();
                    })
            ).addCssText("position: absolute;  width: 100%; height: 100%;")

        )


    </script>
</document>